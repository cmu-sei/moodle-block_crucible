<button type="button" onclick="history.back()" aria-label="Go back"
  style="display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid #e5e7eb;background:#f8fafc;color:#0f172a;border-radius:999px;font-weight:600;cursor:pointer;margin:8px 0 12px;">
  ‚Üê Back
</button>

{{#hasplan}}
  <div style="margin:12px 0;border:1px solid #bbf7d0;background:#dcfce7;color:#166534;border-radius:12px;padding:10px 12px;display:flex;justify-content:space-between;gap:12px;align-items:center;">
    <div style="font-weight:700;">{{#str}} youalreadyhavethisplan, block_crucible {{/str}}</div>
    <a href="{{planurl}}" style="padding:8px 12px;border:1px solid #166534;background:#166534;color:#fff;border-radius:10px;font-weight:700;text-decoration:none;">
      {{#str}} openmyplan, block_crucible {{/str}}
    </a>
  </div>
{{/hasplan}}

<div class="imcite-card imcite-template"
     style="margin:16px auto;border:1px solid #e5e7eb;border-radius:16px;background:#fff;box-shadow:0 6px 16px rgba(2,6,23,.06);overflow:hidden;font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;">

  <!-- Header: title left, action button right -->
  <div style="display:flex;justify-content:space-between;gap:12px;align-items:center;padding:14px 16px;background:linear-gradient(135deg,#e0f2fe,#f8fafc);border-bottom:1px solid #dbeafe;">
    <div style="display:flex;gap:10px;align-items:center;">
      <div style="width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#60a5fa,#2563eb);display:flex;align-items:center;justify-content:center;color:#fff;">üìò</div>
      <div>
        <div style="font-size:20px;font-weight:800;color:#1e3a8a;">{{shortname}}</div>
      </div>
    </div>

    {{#canselfenrol}}
      <form method="post" action="{{selfenrolurl}}" style="margin:0;">
        <button type="submit"
                style="padding:10px 14px;border:1px solid #2563eb;background:#2563eb;color:#fff;border-radius:10px;font-weight:700;cursor:pointer;">
          {{#str}} addtomylearningplans, block_crucible {{/str}}
        </button>
      </form>
    {{/canselfenrol}}
  </div>

  <!-- Body -->
  <div style="padding:16px;background:#fff;">
    {{#description}}
      <div style="font-size:15px;color:#0f172a;margin-bottom:16px;">{{{description}}}</div>
    {{/description}}

    {{#hascomps}}
      <div style="font-size:16px;font-weight:800;color:#0f172a;margin:8px 0 10px;">
        {{#str}} competencies, block_crucible {{/str}}
      </div>

      <div style="display:flex;flex-direction:column;gap:12px;">
        {{#competencies}}
          <div style="border:1px solid #e5e7eb;border-radius:12px;background:#f8fafc;padding:12px;">
            <div style="display:flex;justify-content:space-between;align-items:start;gap:10px;">
              <div>
                <div style="font-weight:800;color:#0f172a;font-size:16px;line-height:1.3;">{{shortname}}</div>
                {{#framework}}
                  <div style="font-size:12px;color:#64748b;margin-top:2px;">{{framework}}</div>
                {{/framework}}
              </div>
              {{#idnumber}}
                <span style="font-size:12px;background:#eef2ff;color:#1e3a8a;border:1px solid #dbeafe;border-radius:999px;padding:2px 8px;white-space:nowrap;">
                  {{idnumber}}
                </span>
              {{/idnumber}}
            </div>

            {{#desc}}
              <div style="margin-top:8px;color:#0f172a;">{{{desc}}}</div>
            {{/desc}}

            {{#hascourses}}
              <div style="margin-top:12px;">
                <div style="font-weight:700;color:#0f172a;margin-bottom:6px;">
                  {{#str}} courses, block_crucible {{/str}}
                </div>

                <ul style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px;">
                  {{#courses}}
                    <li style="border:1px solid #e5e7eb;border-radius:12px;background:#fff;">
                      <!-- Course header row -->
                      <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 12px;">
                        <div>
                          <a href="{{url}}" style="color:#1d4ed8;text-decoration:none;font-weight:800;">
                            {{fullname}}
                          </a>
                          {{#shortname}}
                            <span style="color:#64748b;"> ({{shortname}})</span>
                          {{/shortname}}
                        </div>
                        <span style="font-size:12px;background:#dcfce7;color:#166534;border:1px solid #bbf7d0;
                                    border-radius:999px;padding:2px 8px;white-space:nowrap;display:inline-flex;gap:6px;align-items:center;">
                          üìö {{#str}} course, block_crucible {{/str}}
                        </span>
                      </div>

                      <!-- Activities mapped to this competency (for this course) -->
                      {{#hasacts}}
                        <div style="border-top:1px solid #f1f5f9;padding:10px 12px;background:#f8fafc;border-bottom-left-radius:12px;border-bottom-right-radius:12px;">
                          <div style="font-size:12px;color:#64748b;margin-bottom:6px;display:flex;align-items:center;gap:6px;">
                            ‚ñ∂Ô∏è {{#str}} mappedactivities, block_crucible {{/str}} {{#actcount}}({{actcount}}){{/actcount}}
                          </div>
                          <ul style="list-style:none;margin:0;padding:0 0 0 2px;display:flex;flex-direction:column;gap:4px;">
                            {{#activities}}
                              <li>
                                <a href="{{url}}" style="color:#1d4ed8;text-decoration:none;">{{name}}</a>
                              </li>
                            {{/activities}}
                          </ul>
                        </div>
                      {{/hasacts}}
                    </li>
                  {{/courses}}
                </ul>
              </div>
            {{/hascourses}}
          </div>
        {{/competencies}}
      </div>
    {{/hascomps}}

    {{^hascomps}}
      <div style="border:1px dashed #cbd5e1;border-radius:12px;background:#fff;padding:16px;color:#475569;text-align:center;">
        {{#str}} nocompetenciesintemplate, block_crucible {{/str}}
      </div>
    {{/hascomps}}
  </div>
</div>
