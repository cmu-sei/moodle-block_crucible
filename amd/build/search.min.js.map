{"version":3,"file":"search.min.js","sources":["../src/search.js"],"sourcesContent":["define([], function() {\n  'use strict';\n\n  const $$ = (root, sel) => Array.from(root.querySelectorAll(sel));\n  const $  = (root, sel) => root.querySelector(sel);\n  const norm = (t) => (t || '').toString().trim().toLowerCase();\n\n  function buildCompIndex(compEl) {\n    const parts = [];\n    parts.push(compEl.dataset.compName, compEl.dataset.compFramework, compEl.dataset.compId);\n\n    const title = $(compEl, '.cru-comp-title')?.textContent;\n    const fw    = $(compEl, '.cru-comp-framework')?.textContent;\n    const desc  = $(compEl, '.cru-comp-desc')?.textContent;\n    parts.push(title, fw, desc);\n\n    $$(compEl, '.cru-course').forEach(courseEl => {\n      parts.push(courseEl.dataset.courseName);\n      const linkText = $(courseEl, '.cru-course-link')?.textContent;\n      const shortTxt = $(courseEl, '.cru-course-short')?.textContent;\n      parts.push(linkText, shortTxt);\n\n      $$(courseEl, '.cru-activity').forEach(actEl => {\n        parts.push(actEl.dataset.activityName);\n      });\n    });\n\n    return norm(parts.filter(Boolean).join(' '));\n  }\n\n  function bindTemplate(root, cfg) {\n    const toolbarRoot = cfg?.toolbar ? document.querySelector(cfg.toolbar) : root;\n\n    // ✅ look for inputs in the toolbar (or root if no toolbar provided)\n    const searchInput = $(toolbarRoot, '.lp-search');\n    const clearBtn    = $(toolbarRoot, '.lp-clear');\n    const resCountEl  = $(toolbarRoot, '.lp-result-count');\n\n    const emptyEl     = $(root, '.lp-empty');\n    const groupEls    = $$(root, '.cru-group');\n    const compEls     = $$(root, '.cru-comp');\n\n    if (!searchInput) return;\n\n    const compIndex = new Map();\n    compEls.forEach(c => compIndex.set(c, buildCompIndex(c)));\n\n    function applyFilter() {\n      const q = norm(searchInput.value);\n      let visibleGroups = 0;\n      let visibleComps  = 0;\n      let visibleCourses = 0;\n      let visibleActivities = 0;\n\n      compEls.forEach(compEl => {\n        const blob = compIndex.get(compEl);\n        const compMatches = !q || blob.includes(q);\n\n        let anyCourseVisible = false;\n        $$(compEl, '.cru-course').forEach(courseEl => {\n          let courseVisible = !q;\n          if (q) {\n            const courseBlob = norm([\n              courseEl.dataset.courseName,\n              $(courseEl, '.cru-course-link')?.textContent,\n              $(courseEl, '.cru-course-short')?.textContent\n            ].filter(Boolean).join(' '));\n\n            let anyActVisible = false;\n            $$(courseEl, '.cru-activity').forEach(actEl => {\n              const actName = norm(actEl.dataset.activityName);\n              const actVisible = actName.includes(q) || courseBlob.includes(q) || compMatches;\n              actEl.style.display = actVisible ? '' : 'none';\n              if (actVisible) { anyActVisible = true; visibleActivities++; }\n            });\n\n            courseVisible = compMatches || courseBlob.includes(q) || anyActVisible;\n          }\n\n          courseEl.style.display = courseVisible ? '' : 'none';\n          if (courseVisible) { anyCourseVisible = true; visibleCourses++; }\n        });\n\n        const compVisible = !q || compMatches || anyCourseVisible;\n        compEl.style.display = compVisible ? '' : 'none';\n        if (compVisible) { visibleComps++; }\n\n        if (q) compEl.open = compVisible;\n      });\n\n      groupEls.forEach(groupEl => {\n        const innerComps = $$(groupEl, '.cru-comp');\n        const groupHasVisible = innerComps.some(c => c.style.display !== 'none');\n        groupEl.style.display = groupHasVisible ? '' : 'none';\n        if (q) groupEl.open = groupHasVisible;\n        if (groupHasVisible) visibleGroups++;\n      });\n\n      const hasAnyVisible = visibleComps > 0 && visibleGroups > 0;\n      if (emptyEl) emptyEl.style.display = q && !hasAnyVisible ? '' : 'none';\n\n      if (resCountEl) {\n        if (q) {\n          resCountEl.style.display = 'block';\n          resCountEl.textContent =\n            `${visibleComps} competenc${visibleComps === 1 ? 'y' : 'ies'}, ` +\n            `${visibleCourses} course${visibleCourses === 1 ? '' : 's'}, ` +\n            `${visibleActivities} activit${visibleActivities === 1 ? 'y' : 'ies'} for “${q}”`;\n        } else {\n          resCountEl.style.display = 'none';\n          resCountEl.textContent = '';\n        }\n      }\n\n      if (clearBtn) clearBtn.style.display = q ? 'block' : 'none';\n    }\n\n    searchInput.addEventListener('input', applyFilter);\n\n    if (clearBtn) {\n      clearBtn.addEventListener('click', () => {\n        searchInput.value = '';\n        applyFilter();\n        searchInput.focus();\n      });\n    }\n\n    // Slash-focus\n    root.addEventListener('keydown', (evt) => {\n      if (evt.key === '/' && document.activeElement !== searchInput) {\n        evt.preventDefault();\n        searchInput.focus();\n      }\n    });\n\n    applyFilter();\n  }\n\n  function init(config) {\n    const selector = (typeof config === 'string') ? config : (config?.root || '.lp-template');\n    const toolbar  = (typeof config === 'object') ? config.toolbar : null;\n    document.querySelectorAll(selector).forEach(root => bindTemplate(root, { toolbar }));\n  }\n\n  return { init };\n});\n"],"names":["define","$$","root","sel","Array","from","querySelectorAll","$","querySelector","norm","t","toString","trim","toLowerCase","bindTemplate","cfg","toolbarRoot","toolbar","document","searchInput","clearBtn","resCountEl","emptyEl","groupEls","compEls","compIndex","Map","applyFilter","q","value","visibleGroups","visibleComps","visibleCourses","visibleActivities","forEach","compEl","blob","get","compMatches","includes","anyCourseVisible","courseEl","courseVisible","courseBlob","dataset","courseName","_$6","textContent","_$7","filter","Boolean","join","anyActVisible","actEl","actVisible","activityName","style","display","compVisible","open","groupEl","groupHasVisible","some","c","hasAnyVisible","set","parts","push","compName","compFramework","compId","title","_$","fw","_$2","desc","_$3","linkText","_$4","shortTxt","_$5","buildCompIndex","addEventListener","focus","evt","key","activeElement","preventDefault","init","config","selector"],"mappings":"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"}